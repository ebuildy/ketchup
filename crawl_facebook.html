<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Ketchup</title>
    <link rel="stylesheet" href="./bower_components/components-font-awesome/css/font-awesome.min.css" />
    <link rel="stylesheet" href="./css/home.css" />
</head>
<body>

    <div id="content">
        <div id="dataExtracted">
            <i class="fa fa-refresh fa-spin fa-3x fa-fw"></i>
        </div>
        <a id="btSauce" href="#"><i class="fa fa-flask"></i> Sauce with ketchup!</a>
    </div>

    <script>
        /**
         * Crawl Facebook user information.
         */

        window.fbAsyncInit = function() {
            FB.init({
                appId      : '264382306999887',
                xfbml      : true,
                version    : 'v2.6'
            });

            var access_token = window.location.hash.substring(1);

            FB.api('/me?fields=about,relationship_status,gender,location,locale,interested_in,sports,inspirational_people,work,website,hometown,books,family,tagged_places,music,favorite_teams,favorite_athletes', function(response)
            {
                var data = {
                    gender : '',
                    locale : 'en_US',
                    hometown : '',
                    location : '',
                    places : [],
                    likes : [],
                    musics : []
                };

                if (response.hasOwnProperty('gender'))
                {
                    data.gender = response.gender;
                }

                if (response.hasOwnProperty('locale'))
                {
                    data.locale = response.locale;
                }

                if (response.hasOwnProperty('hometown') && response.hometown.hasOwnProperty('name'))
                {
                    data.hometown = response.hometown.name;
                }

                if (response.hasOwnProperty('location') && response.location.hasOwnProperty('name'))
                {
                    data.location = response.location.name;
                }

                if (response.hasOwnProperty('music') && response.music.hasOwnProperty('data'))
                {
                    $.each(response.music.data, function(i, item)
                    {
                       data.musics.push(item.name);
                    });
                }

                FB.api('/me/likes', function(response)
                {
                    $.each(response.data, function(i, item)
                    {
                        data.likes.push(item.name);
                    });

                    FB.api('/me/tagged_places', function(response)
                    {
                        $.each(response.data, function(i, item)
                        {
                            if (item.hasOwnProperty('place') && item.place.hasOwnProperty('location'))
                            {
                                data.places.push(item.place.location.city);
                            }

                            if (item.hasOwnProperty('place') && item.place.hasOwnProperty('name'))
                            {
                                data.places.push(item.place.name);
                            }
                        });

                        buildUserBagWords(data);
                    },
                    {
                        access_token : access_token
                    });
                },
                {
                    access_token : access_token
                });
            },
            {
                access_token : access_token
            });
        };

        function buildUserBagWords(data)
        {
            var html = '';

            $.each(data, function(i, item)
            {
                html += '<tr><td>' + i + '</td><td>' + item + '</td></tr>';
            });
            console.log(data);
            $('#dataExtracted').html('<table>' + html + '</table>');
        }

        (function(d, s, id){
            var js, fjs = d.getElementsByTagName(s)[0];
            if (d.getElementById(id)) {return;}
            js = d.createElement(s); js.id = id;
            js.src = "//connect.facebook.net/en_US/sdk.js";
            fjs.parentNode.insertBefore(js, fjs);
        }(document, 'script', 'facebook-jssdk'));

    </script>

    <script src="bower_components/jquery/dist/jquery.min.js"></script>

    <style>
        #btSauce
        {
            display: inline-block;
            line-height: 40px;
            background-color: #14b96e;
            color: #fff;
            text-align: center;
            text-decoration: none;
            padding: 5px 20px;
            border-radius: 6px;
        }

        #btSauce i
        {
            font-size: 20px;
            padding-right: 5px;
        }
    </style>

</body>
</html>